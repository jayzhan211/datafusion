
statement ok
CREATE EXTERNAL TABLE hits
STORED AS PARQUET
LOCATION '../../benchmarks/data/hits.parquet';

# query ITI
# SELECT "UserID", "SearchPhrase", COUNT(*) FROM hits GROUP BY "UserID", "SearchPhrase" LIMIT 10;
# ----
# 949984827993538706 эфект 2
# 950002213845432202 (empty) 1
# 950004541571787848 салья машина 2
# 950113409072788610 новости 1
# 950113409072788610 нализация вология у под 1
# 950113409072788610 наруто 2013 онлайн 1
# 950138176938222777 (empty) 1
# 950235578418183544 конденский рубеж смотреть сушуар 1
# 950338919516514282 (empty) 1
# 950338919516514282 ищу районам 1

query TT
explain SELECT "RegionID", COUNT(DISTINCT "UserID") AS u FROM hits GROUP BY "RegionID" ORDER BY u DESC LIMIT 10;
----
logical_plan
01)Sort: u DESC NULLS FIRST, fetch=10
02)--Projection: hits.RegionID, count(alias1) AS u
03)----Aggregate: groupBy=[[hits.RegionID]], aggr=[[count(alias1)]]
04)------Aggregate: groupBy=[[hits.RegionID, hits.UserID AS alias1]], aggr=[[]]
05)--------TableScan: hits projection=[RegionID, UserID]
physical_plan
01)SortPreservingMergeExec: [u@1 DESC], fetch=10
02)--SortExec: TopK(fetch=10), expr=[u@1 DESC], preserve_partitioning=[true]
03)----ProjectionExec: expr=[RegionID@0 as RegionID, count(alias1)@1 as u]
04)------AggregateExec: mode=FinalPartitioned, gby=[RegionID@0 as RegionID], aggr=[count(alias1)]
05)--------CoalesceBatchesExec: target_batch_size=8192
06)----------RepartitionExec: partitioning=Hash([RegionID@0], 4), input_partitions=4
07)------------AggregateExec: mode=Partial, gby=[RegionID@0 as RegionID], aggr=[count(alias1)]
08)--------------AggregateExec: mode=FinalPartitioned, gby=[RegionID@0 as RegionID, alias1@1 as alias1], aggr=[]
09)----------------CoalesceBatchesExec: target_batch_size=8192
10)------------------RepartitionExec: partitioning=Hash([RegionID@0, alias1@1], 4), input_partitions=4
11)--------------------AggregateExec: mode=Partial, gby=[RegionID@0 as RegionID, UserID@1 as alias1], aggr=[]
12)----------------------ParquetExec: file_groups={4 groups: [[WORKSPACE_ROOT/benchmarks/data/hits.parquet:0..3694994112], [WORKSPACE_ROOT/benchmarks/data/hits.parquet:3694994112..7389988224], [WORKSPACE_ROOT/benchmarks/data/hits.parquet:7389988224..11084982336], [WORKSPACE_ROOT/benchmarks/data/hits.parquet:11084982336..14779976446]]}, projection=[RegionID, UserID]
